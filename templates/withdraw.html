{% extends "base.html" %}
{% block content %}

<h2>Withdraw Funds</h2>

<p>
  <strong>Available Balance:</strong>
  ₱{{ "%.2f"|format(user.cash_balance) }}
</p>

<div class="card warning">
  <p><strong>Withdrawal Rules:</strong></p>
  <ul>
    <li>Minimum withdrawal: <strong>₱300</strong></li>
    <li>Processing fee: <strong>5%</strong></li>
    <li>You will receive: <strong>₱285</strong> for ₱300</li>
    <li>Processing time: <strong>1–2 business days</strong></li>
    <li>Processed weekly in batches</li>
  </ul>
</div>

<form method="POST" class="card" id="withdrawForm">

  <label>Amount</label>
  <input type="number" name="amount" min="300" step="1"
         placeholder="Enter amount (min ₱300)" required>

  <label>Withdrawal Method</label>
  <select name="method" required>
    <option value="GCash">GCash</option>
    <option value="Maya">Maya</option>
    <option value="Bank">Bank Transfer</option>
  </select>

  <label>Account Name / Number</label>
  <input type="text" name="account"
         placeholder="GCash / Bank account details" required>

  <label>Email for Notification</label>
  <input type="email" name="notify_email"
         value="{{ user.email }}"
         placeholder="Enter email to receive updates" required>

  <!-- reCAPTCHA token -->
  <input type="hidden" name="recaptcha_token" id="recaptcha_token">

  <button type="submit" class="btn-primary">
    Request Withdrawal
  </button>
</form>

<!-- reCAPTCHA v3 -->
<script src="https://www.google.com/recaptcha/api.js?render={{ RECAPTCHA_SITE_KEY }}"></script>

<script>
document.getElementById("withdrawForm").addEventListener("submit", function (e) {
  e.preventDefault();

  grecaptcha.ready(function () {
    grecaptcha.execute("{{ RECAPTCHA_SITE_KEY }}", { action: "withdraw" })
      .then(function (token) {
        document.getElementById("recaptcha_token").value = token;
        document.getElementById("withdrawForm").submit();
      });
  });
});
</script>

{% endblock %}
